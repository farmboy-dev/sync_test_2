Thanos Sidecar:
The Thanos Sidecar is added to existing Prometheus servers to persistently store their data in Object Storage (e.g., AWS S3, Google Cloud Storage). This enables backup of Prometheus server data and sharing of data across multiple Prometheus servers.

Thanos Querier:
The Thanos Querier consolidates and queries data collected from multiple Prometheus servers. When a query is executed, the Thanos Querier combines data from Prometheus servers and Object Storage to generate a unified response.

Thanos Store Gateway:
The Thanos Store Gateway reads data stored in Object Storage and responds to queries from Prometheus servers. This allows a central querying service (Querier) to query not only Prometheus server data but also data stored in Object Storage.

Thanos Ruler:
The Thanos Ruler performs functions similar to the existing Prometheus Alertmanager. It evaluates and manages rules and alerts, forwarding results to the Alertmanager for alert processing and notifications.

Thanos Compactor:
The Thanos Compactor continuously optimizes and merges data in Object Storage, addressing the growing size of stored data. This helps optimize data size in the long term.

Prometheus Server:

The core component responsible for collecting and storing time-series data. It uses a pull-based model to scrape metrics from configured targets and stores the data locally.
Prometheus Storage:

Manages the local storage of time-series data collected by the Prometheus server. Data is stored in a time-series database, making it efficient for querying historical metrics.
Prometheus Query Language (PromQL):

A powerful query language used to retrieve and analyze time-series data stored in Prometheus. PromQL allows users to perform complex queries and aggregations.
Alertmanager:

Manages and processes alerts generated by Prometheus. It allows users to define alerting rules and handles the routing and notification of alerts to various channels (e.g., email, Slack).
Exporters:

Specialized components that expose metrics from third-party systems in a format Prometheus can scrape. Exporters enable Prometheus to monitor diverse applications and services.
Node Exporter:

A commonly used exporter for collecting system-level metrics from hosts, including CPU usage, memory usage, disk space, and network statistics.
Pushgateway:

Allows short-lived jobs or batch processes to push metrics to Prometheus. This is useful for scenarios where the usual pull-based model isn't suitable.

curl -XPOST -d '[{"labels":{"alertname":"TestAlert"},"annotations":{"summary":"Test notification"}}]' http://alertmanager-url:port/api/v1/alerts

kubectl delete crd alertmanagerconfigs.monitoring.coreos.com
kubectl delete crd alertmanagers.monitoring.coreos.com
kubectl delete crd podmonitors.monitoring.coreos.com
kubectl delete crd probes.monitoring.coreos.com
kubectl delete crd prometheusagents.monitoring.coreos.com
kubectl delete crd prometheuses.monitoring.coreos.com
kubectl delete crd prometheusrules.monitoring.coreos.com
kubectl delete crd scrapeconfigs.monitoring.coreos.com
kubectl delete crd servicemonitors.monitoring.coreos.com
kubectl delete crd thanosrulers.monitoring.coreos.com

cat <<EOF > objstore.yaml
type: s3
config:
  bucket: thanos
  endpoint: thanos-minio:9000
  access_key: admin
  secret_key: password
  insecure: true
EOF


kubectl create namespace monitoring
kubectl create secret generic objstore-secret \
  --from-file=objstore.yml \
  --namespace monitoring

cat <<EOF > value-override-thanos-sidecar.yaml
prometheus:
  prometheusSpec:
    thanos:
      objectStorageConfig:
        key: objstore.yml
        name: objstore-secret
EOF


helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
helm repo add bitnami https://charts.bitnami.com/bitnami
helm repo update

helm install thanos bitnami/thanos \
  --namespace monitoring \
  --set query.dnsDiscovery.enabled=true \
  --set "query.dnsDiscovery.sidecarsService=kube-prometheus-stack-thanos-discovery" \
  --set query.dnsDiscovery.sidecarsNamespace=monitoring \
  --set minio.enabled=true \
  --set minio.auth.rootPassword=password

helm install prometheus-operator-crds prometheus-community/kube-prometheus-stack \
  --namespace monitoring

helm install kube-prometheus-stack prometheus-community/kube-prometheus-stack \
  --values value-override-thanos-sidecar.yaml \
  --namespace monitoring \
  --set prometheus.thanosService.enabled=true \
  --set "prometheus.thanosService.clusterIP= "
